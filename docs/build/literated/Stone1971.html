<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Stone1971 Â· BiGSTARS.jl</title><meta name="title" content="Stone1971 Â· BiGSTARS.jl"/><meta property="og:title" content="Stone1971 Â· BiGSTARS.jl"/><meta property="twitter:title" content="Stone1971 Â· BiGSTARS.jl"/><meta name="description" content="Documentation for BiGSTARS.jl."/><meta property="og:description" content="Documentation for BiGSTARS.jl."/><meta property="twitter:description" content="Documentation for BiGSTARS.jl."/><meta property="og:url" content="https://github.com/subhk/BiGSTARSDocumentation.git/stable/literated/Stone1971.html"/><meta property="twitter:url" content="https://github.com/subhk/BiGSTARSDocumentation.git/stable/literated/Stone1971.html"/><link rel="canonical" href="https://github.com/subhk/BiGSTARSDocumentation.git/stable/literated/Stone1971.html"/><script data-outdated-warner src="../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL=".."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../assets/documenter.js"></script><script src="../search_index.js"></script><script src="../siteinfo.js"></script><script src="../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-mocha.css" data-theme-name="catppuccin-mocha"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-macchiato.css" data-theme-name="catppuccin-macchiato"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-frappe.css" data-theme-name="catppuccin-frappe"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-latte.css" data-theme-name="catppuccin-latte"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href="../index.html">BiGSTARS.jl</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="../index.html">Home</a></li><li><a class="tocitem" href="../installation_instructions.html">Installation</a></li><li><span class="tocitem">Examples</span><ul><li class="is-active"><a class="tocitem" href="Stone1971.html">Stone1971</a></li><li><a class="tocitem" href="rRBC.html">rRBC</a></li></ul></li><li><a class="tocitem" href="../contributing.html">Contributor&#39;s Guide</a></li><li><a class="tocitem" href="../references.html">References</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Examples</a></li><li class="is-active"><a href="Stone1971.html">Stone1971</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href="Stone1971.html">Stone1971</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/subhk/BiGSTARS.jl" title="View the repository on GitHub"><span class="docs-icon fa-brands">ï‚›</span><span class="docs-label is-hidden-touch">GitHub</span></a><a class="docs-navbar-link" href="https://github.com/subhk/BiGSTARS.jl/blob/main/docs/src/literated/Stone1971.md" title="Edit source on GitHub"><span class="docs-icon fa-solid">ï„</span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><pre><code class="language-julia hljs">&quot;&quot;&quot;
Stability of a 2D front based on Stone (1971)
&quot;&quot;&quot;
# load required packages
using LazyGrids
using LinearAlgebra
using Printf
using StaticArrays
using SparseArrays
using SparseMatrixDicts
using FillArrays
using SpecialFunctions
using Parameters
using Test
using BenchmarkTools

using JLD2
using ModelingToolkit
using NonlinearSolve

using BiGSTARS
using BiGSTARS : FourierDiff, cheb_coord_transform_ho,

@with_kw mutable struct TwoDimGrid{Ny, Nz}
    y = @SVector zeros(Float64, Ny)
    z = @SVector zeros(Float64, Nz)
end

@with_kw mutable struct ChebMarix{Ny, Nz}
    ğ’ŸÊ¸::Array{Float64,  2}   = SparseMatrixCSC(Zeros(Ny, Ny))
    ğ’ŸÂ²Ê¸::Array{Float64, 2}   = SparseMatrixCSC(Zeros(Ny, Ny))
    ğ’Ÿâ´Ê¸::Array{Float64, 2}   = SparseMatrixCSC(Zeros(Ny, Ny))

    ğ’Ÿá¶»::Array{Float64,  2}   = SparseMatrixCSC(Zeros(Nz, Nz))
    ğ’ŸÂ²á¶»::Array{Float64, 2}   = SparseMatrixCSC(Zeros(Nz, Nz))
    ğ’Ÿâ´á¶»::Array{Float64, 2}   = SparseMatrixCSC(Zeros(Nz, Nz))

    ğ’Ÿá¶»á´º::Array{Float64,  2}  = SparseMatrixCSC(Zeros(Nz, Nz))
    ğ’ŸÂ²á¶»á´º::Array{Float64, 2}  = SparseMatrixCSC(Zeros(Nz, Nz))
    ğ’Ÿâ´á¶»á´º::Array{Float64, 2}  = SparseMatrixCSC(Zeros(Nz, Nz))

    ğ’Ÿá¶»á´°::Array{Float64,  2}  = SparseMatrixCSC(Zeros(Nz, Nz))
    ğ’ŸÂ²á¶»á´°::Array{Float64, 2}  = SparseMatrixCSC(Zeros(Nz, Nz))
    ğ’Ÿâ´á¶»á´°::Array{Float64, 2}  = SparseMatrixCSC(Zeros(Nz, Nz))
end

@with_kw mutable struct Operator{N}
&quot;&quot;&quot;
    `subperscript with N&#39; means Operator with Neumann boundary condition
        after kronker product
    `subperscript with D&#39; means Operator with Dirchilet boundary condition
        after kronker product
&quot;&quot;&quot;

    ğ’ŸÊ¸::Array{Float64,  2}   = SparseMatrixCSC(Zeros(N, N))
    ğ’ŸÂ²Ê¸::Array{Float64, 2}   = SparseMatrixCSC(Zeros(N, N))
    ğ’Ÿâ´Ê¸::Array{Float64, 2}   = SparseMatrixCSC(Zeros(N, N))

    ğ’Ÿá¶»::Array{Float64,  2}  = SparseMatrixCSC(Zeros(N, N))
    ğ’ŸÂ²á¶»::Array{Float64, 2}  = SparseMatrixCSC(Zeros(N, N))

    ğ’Ÿá¶»á´º::Array{Float64,  2}  = SparseMatrixCSC(Zeros(N, N))
    ğ’ŸÂ²á¶»á´º::Array{Float64, 2}  = SparseMatrixCSC(Zeros(N, N))
    ğ’Ÿâ´á¶»á´º::Array{Float64, 2}  = SparseMatrixCSC(Zeros(N, N))

    ğ’Ÿá¶»á´°::Array{Float64,  2}  = SparseMatrixCSC(Zeros(N, N))
    ğ’ŸÊ¸á¶»á´°::Array{Float64, 2}  = SparseMatrixCSC(Zeros(N, N))
    ğ’ŸÂ²á¶»á´°::Array{Float64, 2}  = SparseMatrixCSC(Zeros(N, N))
    ğ’Ÿâ´á¶»á´°::Array{Float64, 2}  = SparseMatrixCSC(Zeros(N, N))

    ğ’ŸÊ¸Â²á¶»á´°::Array{Float64,  2}  = SparseMatrixCSC(Zeros(N, N))
    ğ’ŸÂ²Ê¸Â²á¶»á´°::Array{Float64, 2}  = SparseMatrixCSC(Zeros(N, N))
end

@with_kw mutable struct MeanFlow{N}
    Bâ‚€::Array{Float64, 2} = SparseMatrixCSC(Zeros(N, N))
    Uâ‚€::Array{Float64, 2} = SparseMatrixCSC(Zeros(N, N))

  âˆ‡Ê¸Uâ‚€::Array{Float64, 2} = SparseMatrixCSC(Zeros(N, N))
  âˆ‡á¶»Uâ‚€::Array{Float64, 2} = SparseMatrixCSC(Zeros(N, N))
  âˆ‡Ê¸Bâ‚€::Array{Float64, 2} = SparseMatrixCSC(Zeros(N, N))
  âˆ‡á¶»Bâ‚€::Array{Float64, 2} = SparseMatrixCSC(Zeros(N, N))

  âˆ‡Ê¸Ê¸Uâ‚€::Array{Float64, 2} = SparseMatrixCSC(Zeros(N, N))
  âˆ‡á¶»á¶»Uâ‚€::Array{Float64, 2} = SparseMatrixCSC(Zeros(N, N))
  âˆ‡Ê¸á¶»Uâ‚€::Array{Float64, 2} = SparseMatrixCSC(Zeros(N, N))
end</code></pre><p>function Construct_DerivativeOperator!(diffMatrix, grid, params)     N = params.Ny * params.Nz</p><pre><code class="nohighlight hljs">y1, diffMatrix.ğ’ŸÊ¸  = FourierDiff(params.Ny, 1)
y2, d2y = FourierDiff(params.Ny, 2)
diffMatrix.ğ’ŸÂ²Ê¸ = d2y
# y4, d4y = FourierDiff(params.Ny, 4)
# diffMatrix.ğ’Ÿâ´Ê¸ = d4y

# Transform the domain and derivative operators from [0, 2Ï€) â†’ [0, L)
grid.y         = params.L/2Ï€  * y1
diffMatrix.ğ’ŸÊ¸  = (2Ï€/params.L)^1 * diffMatrix.ğ’ŸÊ¸
diffMatrix.ğ’ŸÂ²Ê¸ = (2Ï€/params.L)^2 * diffMatrix.ğ’ŸÂ²Ê¸
diffMatrix.ğ’Ÿâ´Ê¸ = (2Ï€/params.L)^4 * diffMatrix.ğ’Ÿâ´Ê¸

z1,  D1z = chebdif(params.Nz, 1)
z2,  D2z = chebdif(params.Nz, 2)
z3,  D3z = chebdif(params.Nz, 3)
z4,  D4z = chebdif(params.Nz, 4)

## Transform the domain and derivative operators from [-1, 1] â†’ [0, H]
grid.z, diffMatrix.ğ’Ÿá¶», diffMatrix.ğ’ŸÂ²á¶»  = chebder_transform(z1,  D1z,
                                                                D2z,
                                                                zerotoL_transform,
                                                                params.H)
p1, q1, diffMatrix.ğ’Ÿâ´á¶» = chebder_transform_ho(z1, D1z,
                                                D2z,
                                                D3z,
                                                D4z,
                                                zerotoL_transform_ho,
                                                params.H)

return nothing</code></pre><p>end</p><p>function ImplementBCs_cheb!(Op, diffMatrix, params)     IÊ¸ = sparse(Matrix(1.0I, params.Ny, params.Ny))     Iá¶» = sparse(Matrix(1.0I, params.Nz, params.Nz))</p><pre><code class="nohighlight hljs"># Cheb matrix with Dirichilet boundary condition
@. diffMatrix.ğ’Ÿá¶»á´°  = diffMatrix.ğ’Ÿá¶»
@. diffMatrix.ğ’ŸÂ²á¶»á´° = diffMatrix.ğ’ŸÂ²á¶»
@. diffMatrix.ğ’Ÿâ´á¶»á´° = diffMatrix.ğ’Ÿâ´á¶»

# Cheb matrix with Neumann boundary condition
@. diffMatrix.ğ’Ÿá¶»á´º  = diffMatrix.ğ’Ÿá¶»
@. diffMatrix.ğ’ŸÂ²á¶»á´º = diffMatrix.ğ’ŸÂ²á¶»

n = params.Nz
for iter âˆˆ 1:n-1
    diffMatrix.ğ’Ÿâ´á¶»á´°[1,iter+1] = (diffMatrix.ğ’Ÿâ´á¶»á´°[1,iter+1] +
                            -1.0 * diffMatrix.ğ’Ÿâ´á¶»á´°[1,1] * diffMatrix.ğ’ŸÂ²á¶»á´°[1,iter+1])

      diffMatrix.ğ’Ÿâ´á¶»á´°[n,iter] = (diffMatrix.ğ’Ÿâ´á¶»á´°[n,iter] +
                            -1.0 * diffMatrix.ğ’Ÿâ´á¶»á´°[n,n] * diffMatrix.ğ’ŸÂ²á¶»á´°[n,iter])
end

diffMatrix.ğ’Ÿá¶»á´°[1,1]  = 0.0
diffMatrix.ğ’Ÿá¶»á´°[n,n]  = 0.0

diffMatrix.ğ’ŸÂ²á¶»á´°[1,1] = 0.0
diffMatrix.ğ’ŸÂ²á¶»á´°[n,n] = 0.0

diffMatrix.ğ’Ÿâ´á¶»á´°[1,1] = 0.0
diffMatrix.ğ’Ÿâ´á¶»á´°[n,n] = 0.0

# Neumann boundary condition
@. diffMatrix.ğ’Ÿá¶»á´º  = diffMatrix.ğ’Ÿá¶»
@. diffMatrix.ğ’ŸÂ²á¶»á´º = diffMatrix.ğ’ŸÂ²á¶»
for iter âˆˆ 1:n-1
    diffMatrix.ğ’ŸÂ²á¶»á´º[1,iter+1] = (diffMatrix.ğ’ŸÂ²á¶»á´º[1,iter+1] +
                            -1.0 * diffMatrix.ğ’ŸÂ²á¶»á´º[1,1] * diffMatrix.ğ’Ÿá¶»á´º[1,iter+1]/diffMatrix.ğ’Ÿá¶»á´º[1,1])

    diffMatrix.ğ’ŸÂ²á¶»á´º[n,iter]   = (diffMatrix.ğ’ŸÂ²á¶»á´º[n,iter] +
                            -1.0 * diffMatrix.ğ’ŸÂ²á¶»á´º[n,n] * diffMatrix.ğ’Ÿá¶»á´º[n,iter]/diffMatrix.ğ’Ÿá¶»á´º[n,n])
end

diffMatrix.ğ’ŸÂ²á¶»á´º[1,1] = 0.0
diffMatrix.ğ’ŸÂ²á¶»á´º[n,n] = 0.0

@. diffMatrix.ğ’Ÿá¶»á´º[1,1:end] = 0.0
@. diffMatrix.ğ’Ÿá¶»á´º[n,1:end] = 0.0

#setBCs!(diffMatrix, params, &quot;dirchilet&quot;)
#setBCs!(diffMatrix, params, &quot;neumann&quot;  )

kron!( Op.ğ’Ÿá¶»á´°  ,  IÊ¸ , diffMatrix.ğ’Ÿá¶»á´°  )
kron!( Op.ğ’ŸÂ²á¶»á´° ,  IÊ¸ , diffMatrix.ğ’ŸÂ²á¶»á´° )
kron!( Op.ğ’Ÿâ´á¶»á´° ,  IÊ¸ , diffMatrix.ğ’Ÿâ´á¶»á´° )

kron!( Op.ğ’Ÿá¶»á´º  ,  IÊ¸ , diffMatrix.ğ’Ÿá¶»á´º )
kron!( Op.ğ’ŸÂ²á¶»á´º ,  IÊ¸ , diffMatrix.ğ’ŸÂ²á¶»á´º)

kron!( Op.ğ’ŸÊ¸   ,  diffMatrix.ğ’ŸÊ¸  ,  Iá¶» )
kron!( Op.ğ’ŸÂ²Ê¸  ,  diffMatrix.ğ’ŸÂ²Ê¸ ,  Iá¶» )
kron!( Op.ğ’Ÿâ´Ê¸  ,  diffMatrix.ğ’Ÿâ´Ê¸ ,  Iá¶» )

kron!( Op.ğ’ŸÊ¸á¶»á´°   ,  diffMatrix.ğ’ŸÊ¸  ,  diffMatrix.ğ’Ÿá¶»á´°  )
kron!( Op.ğ’ŸÊ¸Â²á¶»á´°  ,  diffMatrix.ğ’ŸÊ¸  ,  diffMatrix.ğ’ŸÂ²á¶»á´° )
kron!( Op.ğ’ŸÂ²Ê¸Â²á¶»á´° ,  diffMatrix.ğ’ŸÂ²Ê¸ ,  diffMatrix.ğ’ŸÂ²á¶»á´° )

return nothing</code></pre><p>end</p><p>function BasicState!(diffMatrix, mf, grid, params)     Y, Z = ndgrid(grid.y, grid.z)     Y    = transpose(Y)     Z    = transpose(Z)</p><pre><code class="nohighlight hljs"># imposed buoyancy profile
Bâ‚€   = @. 1.0/params.Î“ * Z - Y
âˆ‚Ê¸Bâ‚€ = - 1.0 .* ones(size(Y))
âˆ‚á¶»Bâ‚€ = 1.0/params.Î“ .* ones(size(Y))

Uâ‚€      = @. 1.0 * Z - 0.5params.H
âˆ‚á¶»Uâ‚€    = ones( size(Y))
âˆ‚Ê¸Uâ‚€    = zeros(size(Y))

âˆ‚Ê¸Ê¸Uâ‚€   = zeros(size(Y))
âˆ‚Ê¸á¶»Uâ‚€   = zeros(size(Y))
âˆ‚á¶»á¶»Uâ‚€   = zeros(size(Y))

  Bâ‚€  = Bâ‚€[:];
  Uâ‚€  = Uâ‚€[:];
âˆ‚Ê¸Bâ‚€  = âˆ‚Ê¸Bâ‚€[:];
âˆ‚á¶»Bâ‚€  = âˆ‚á¶»Bâ‚€[:];

âˆ‚á¶»Uâ‚€  = âˆ‚á¶»Uâ‚€[:];
âˆ‚Ê¸Uâ‚€  = âˆ‚Ê¸Uâ‚€[:];

âˆ‚Ê¸Ê¸Uâ‚€ = âˆ‚Ê¸Ê¸Uâ‚€[:];
âˆ‚Ê¸á¶»Uâ‚€ = âˆ‚Ê¸á¶»Uâ‚€[:];
âˆ‚á¶»á¶»Uâ‚€ = âˆ‚á¶»á¶»Uâ‚€[:];

mf.Bâ‚€[diagind(mf.Bâ‚€)] = Bâ‚€
mf.Uâ‚€[diagind(mf.Uâ‚€)] = Uâ‚€

mf.âˆ‡á¶»Uâ‚€[diagind(mf.âˆ‡á¶»Uâ‚€)] = âˆ‚á¶»Uâ‚€
mf.âˆ‡Ê¸Uâ‚€[diagind(mf.âˆ‡Ê¸Uâ‚€)] = âˆ‚Ê¸Uâ‚€

mf.âˆ‡Ê¸Bâ‚€[diagind(mf.âˆ‡Ê¸Bâ‚€)] = âˆ‚Ê¸Bâ‚€
mf.âˆ‡á¶»Bâ‚€[diagind(mf.âˆ‡á¶»Bâ‚€)] = âˆ‚á¶»Bâ‚€

mf.âˆ‡Ê¸Ê¸Uâ‚€[diagind(mf.âˆ‡Ê¸Ê¸Uâ‚€)] = âˆ‚Ê¸Ê¸Uâ‚€;
mf.âˆ‡á¶»á¶»Uâ‚€[diagind(mf.âˆ‡á¶»á¶»Uâ‚€)] = âˆ‚á¶»á¶»Uâ‚€;
mf.âˆ‡Ê¸á¶»Uâ‚€[diagind(mf.âˆ‡Ê¸á¶»Uâ‚€)] = âˆ‚Ê¸á¶»Uâ‚€;

return nothing</code></pre><p>end</p><pre><code class="language-julia hljs">function construct_matrices(Op, mf, grid, params)
    Y, Z = ndgrid(grid.y, grid.z)
    Y    = transpose(Y)
    Z    = transpose(Z)

    # basic state
    Bâ‚€   = @. 1.0/params.Î“ * Z - Y
    âˆ‚Ê¸Bâ‚€ = - 1.0 .* ones(size(Y))
    âˆ‚á¶»Bâ‚€ = 1.0/params.Î“ .* ones(size(Y))

    Uâ‚€      = @. 1.0 * Z - 0.5params.H
    âˆ‚á¶»Uâ‚€    = ones( size(Y))
    âˆ‚Ê¸Uâ‚€    = zeros(size(Y))

    âˆ‚Ê¸Ê¸Uâ‚€   = zeros(size(Y))
    âˆ‚Ê¸á¶»Uâ‚€   = zeros(size(Y))
    âˆ‚á¶»á¶»Uâ‚€   = zeros(size(Y))

      Bâ‚€  = Bâ‚€[:];
      Uâ‚€  = Uâ‚€[:];
    âˆ‚Ê¸Bâ‚€  = âˆ‚Ê¸Bâ‚€[:];
    âˆ‚á¶»Bâ‚€  = âˆ‚á¶»Bâ‚€[:];

    âˆ‚á¶»Uâ‚€  = âˆ‚á¶»Uâ‚€[:];
    âˆ‚Ê¸Uâ‚€  = âˆ‚Ê¸Uâ‚€[:];

    âˆ‚Ê¸Ê¸Uâ‚€ = âˆ‚Ê¸Ê¸Uâ‚€[:];
    âˆ‚Ê¸á¶»Uâ‚€ = âˆ‚Ê¸á¶»Uâ‚€[:];
    âˆ‚á¶»á¶»Uâ‚€ = âˆ‚á¶»á¶»Uâ‚€[:];

    mf.Bâ‚€[diagind(mf.Bâ‚€)] = Bâ‚€
    mf.Uâ‚€[diagind(mf.Uâ‚€)] = Uâ‚€

    mf.âˆ‡á¶»Uâ‚€[diagind(mf.âˆ‡á¶»Uâ‚€)] = âˆ‚á¶»Uâ‚€
    mf.âˆ‡Ê¸Uâ‚€[diagind(mf.âˆ‡Ê¸Uâ‚€)] = âˆ‚Ê¸Uâ‚€

    mf.âˆ‡Ê¸Bâ‚€[diagind(mf.âˆ‡Ê¸Bâ‚€)] = âˆ‚Ê¸Bâ‚€
    mf.âˆ‡á¶»Bâ‚€[diagind(mf.âˆ‡á¶»Bâ‚€)] = âˆ‚á¶»Bâ‚€

    mf.âˆ‡Ê¸Ê¸Uâ‚€[diagind(mf.âˆ‡Ê¸Ê¸Uâ‚€)] = âˆ‚Ê¸Ê¸Uâ‚€;
    mf.âˆ‡á¶»á¶»Uâ‚€[diagind(mf.âˆ‡á¶»á¶»Uâ‚€)] = âˆ‚á¶»á¶»Uâ‚€;
    mf.âˆ‡Ê¸á¶»Uâ‚€[diagind(mf.âˆ‡Ê¸á¶»Uâ‚€)] = âˆ‚Ê¸á¶»Uâ‚€;

    N  = params.Ny * params.Nz
    Iâ° = sparse(Matrix(1.0I, N, N)) #Eye{Float64}(N)
    sâ‚ = size(Iâ°, 1); sâ‚‚ = size(Iâ°, 2)

    # allocating memory for the LHS and RHS matrices
    ğ“›â‚ = SparseMatrixCSC(Zeros{ComplexF64}(sâ‚, 3sâ‚‚))
    ğ“›â‚‚ = SparseMatrixCSC(Zeros{ComplexF64}(sâ‚, 3sâ‚‚))
    ğ“›â‚ƒ = SparseMatrixCSC(Zeros{ComplexF64}(sâ‚, 3sâ‚‚))

    â„³â‚ = SparseMatrixCSC(Zeros{Float64}(sâ‚, 3sâ‚‚))
    â„³â‚‚ = SparseMatrixCSC(Zeros{Float64}(sâ‚, 3sâ‚‚))
    â„³â‚ƒ = SparseMatrixCSC(Zeros{Float64}(sâ‚, 3sâ‚‚))

    âˆ‡â‚•Â² = SparseMatrixCSC(Zeros(N, N))
    H   = SparseMatrixCSC(Zeros(N, N))

    âˆ‡â‚•Â² = (1.0 * Op.ğ’ŸÂ²Ê¸ - 1.0 * params.kâ‚“^2 * Iâ°)


    H = inverse_Lap_hor(âˆ‡â‚•Â²)
    @assert norm(âˆ‡â‚•Â² * H - Iâ°) â‰¤ 1.0e-4 &quot;difference in L2-norm should be small&quot;


    Dâ´  = (1.0 * Op.ğ’Ÿâ´Ê¸
        + 1.0/params.Îµ^4 * Op.ğ’Ÿâ´á¶»á´°
        + 1.0params.kâ‚“^4 * Iâ°
        - 2.0params.kâ‚“^2 * Op.ğ’ŸÂ²Ê¸
        - 2.0/params.Îµ^2 * params.kâ‚“^2 * Op.ğ’ŸÂ²á¶»á´°
        + 2.0/params.Îµ^2 * Op.ğ’ŸÂ²Ê¸Â²á¶»á´°)

    DÂ²  = (1.0/params.Îµ^2 * Op.ğ’ŸÂ²á¶»á´° + 1.0 * âˆ‡â‚•Â²)
    Dâ‚™Â² = (1.0/params.Îµ^2 * Op.ğ’ŸÂ²á¶»á´º + 1.0 * âˆ‡â‚•Â²)

    # 1. uá¶» (vertical velocity)  equation (bcs: uá¶» = âˆ‚á¶»á¶»uá¶» = 0 @ z = 0, 1)
    ğ“›â‚[:,    1:1sâ‚‚] = (-1.0params.E * Dâ´
                    + 1.0im * params.kâ‚“ * mf.Uâ‚€ * DÂ²) * params.Îµ^2
    ğ“›â‚[:,1sâ‚‚+1:2sâ‚‚] = 1.0 * Op.ğ’Ÿá¶»á´º
    ğ“›â‚[:,2sâ‚‚+1:3sâ‚‚] = -1.0 * âˆ‡â‚•Â²

    # 2. Ï‰á¶» (vertical vorticity) equation (bcs: âˆ‚á¶»Ï‰á¶» = 0 @ z = 0, 1)
    ğ“›â‚‚[:,    1:1sâ‚‚] = - 1.0 * mf.âˆ‡á¶»Uâ‚€ * Op.ğ’ŸÊ¸ - 1.0 * Op.ğ’Ÿá¶»á´°
    ğ“›â‚‚[:,1sâ‚‚+1:2sâ‚‚] = (1.0im * params.kâ‚“ * mf.Uâ‚€ * Iâ°
                    - 1.0params.E * Dâ‚™Â²)
    ğ“›â‚‚[:,2sâ‚‚+1:3sâ‚‚] = 0.0 * Iâ°

    # 3. b (buoyancy) equation (bcs: b = 0 @ z = 0, 1)
    ğ“›â‚ƒ[:,    1:1sâ‚‚] = (1.0 * mf.âˆ‡á¶»Bâ‚€ * Iâ°
                    - 1.0 * mf.âˆ‡Ê¸Bâ‚€ * H * Op.ğ’ŸÊ¸á¶»á´°)
    ğ“›â‚ƒ[:,1sâ‚‚+1:2sâ‚‚] = 1.0im * params.kâ‚“ * mf.âˆ‡Ê¸Bâ‚€ * H * Iâ°
    ğ“›â‚ƒ[:,2sâ‚‚+1:3sâ‚‚] = (-1.0params.E * Dâ‚™Â²
                    + 1.0im * params.kâ‚“ * mf.Uâ‚€ * Iâ°)

    ğ“› = ([ğ“›â‚; ğ“›â‚‚; ğ“›â‚ƒ]);


    cnst = -1.0
    â„³â‚[:,    1:1sâ‚‚] = 1.0cnst * params.Îµ^2 * DÂ²;
    â„³â‚‚[:,1sâ‚‚+1:2sâ‚‚] = 1.0cnst * Iâ°;
    â„³â‚ƒ[:,2sâ‚‚+1:3sâ‚‚] = 1.0cnst * Iâ°;
    â„³ = ([â„³â‚; â„³â‚‚; â„³â‚ƒ])

    return ğ“›, â„³
end</code></pre><p>Parameters:</p><pre><code class="language-julia hljs">@with_kw mutable struct Params{T&lt;:Real} @deftype T
    L::T        = 1.0        # horizontal domain size
    H::T        = 1.0        # vertical domain size
    Î“::T        = 0.1        # front strength Î“ â‰¡ MÂ²/fÂ² = Î»/H = 1/Îµ â†’ Îµ = 1/Î“
    Îµ::T        = 0.1        # aspect ratio Îµ â‰¡ H/L
    kâ‚“::T       = 0.0        # x-wavenumber
    E::T        = 1.0e-9     # Ekman number
    Ny::Int64   = 48         # no. of y-grid points
    Nz::Int64   = 24         # no. of z-grid points
    method::String = &quot;krylov&quot;
end


function EigSolver(Op, mf, grid, params, Ïƒâ‚€)

    ğ“›, â„³ = construct_matrices(Op, mf, grid, params)

    N = params.Ny * params.Nz
    MatrixSize = 3N
    @assert size(ğ“›, 1)  == MatrixSize &amp;&amp;
            size(ğ“›, 2)  == MatrixSize &amp;&amp;
            size(â„³, 1)  == MatrixSize &amp;&amp;
            size(â„³, 2)  == MatrixSize &quot;matrix size does not match!&quot;

    if params.method == &quot;shift_invert&quot;
        Î»â‚› = EigSolver_shift_invert( ğ“›, â„³, Ïƒâ‚€=Ïƒâ‚€)

    elseif params.method == &quot;krylov&quot;

        Î»â‚›, Î§ = EigSolver_shift_invert_krylov( ğ“›, â„³, Ïƒâ‚€=Ïƒâ‚€, maxiter=40, which=:LR)


    elseif params.method == &quot;arnoldi&quot;

        Î»â‚›, Î§ = EigSolver_shift_invert_arnoldi( ğ“›, â„³, Ïƒâ‚€=Ïƒâ‚€, maxiter=40, which=:LR)
    end</code></pre><p>======================================================================</p><pre><code class="language-julia hljs">    @assert length(Î»â‚›) &gt; 0 &quot;No eigenvalue(s) found!&quot;

    @printf &quot;||ğ“›Î§ - Î»â‚›â„³Î§||â‚‚: %f \n&quot; norm(ğ“› * Î§[:,1] - Î»â‚›[1] * â„³ * Î§[:,1])

    @printf &quot;largest growth rate : %1.4e%+1.4eim\n&quot; real(Î»â‚›[1]) imag(Î»â‚›[1])

    return Î»â‚›[1] #, Î§[:,1]
end


function solve_Stone1971(kâ‚“::Float64=0.0)
    params      = Params{Float64}(kâ‚“=0.5)
    grid        = TwoDimGrid{params.Ny,  params.Nz}()
    diffMatrix  = ChebMarix{ params.Ny,  params.Nz}()
    Op          = Operator{params.Ny * params.Nz}()
    mf          = MeanFlow{params.Ny * params.Nz}()

    Construct_DerivativeOperator!(diffMatrix, grid, params)
    ImplementBCs_cheb!(Op, diffMatrix, params)

    Ïƒâ‚€   = 0.01
    params.kâ‚“ = kâ‚“

    Î»â‚› = EigSolver(Op, mf, grid, params, Ïƒâ‚€)

    # Analytical solution of Stone (1971) for the growth rate
    cnst = 1.0 + 1.0/params.Î“ + 5.0*params.Îµ^2 * params.kâ‚“^2/42.0
    Î»â‚›â‚œ = 1.0/(2.0*âˆš3.0) * (params.kâ‚“ - 2.0/15.0 * params.kâ‚“^3 * cnst)

    return abs(Î»â‚›.re - Î»â‚›â‚œ) &lt; 1e-3

end

solve_Stone1971(0.1)

println(&quot;Example runs OK&quot;)</code></pre><hr/><p><em>This page was generated using <a href="https://github.com/fredrikekre/Literate.jl">Literate.jl</a>.</em></p></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../installation_instructions.html">Â« Installation</a><a class="docs-footer-nextpage" href="rRBC.html">rRBC Â»</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="auto">Automatic (OS)</option><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option><option value="catppuccin-latte">catppuccin-latte</option><option value="catppuccin-frappe">catppuccin-frappe</option><option value="catppuccin-macchiato">catppuccin-macchiato</option><option value="catppuccin-mocha">catppuccin-mocha</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.13.0 on <span class="colophon-date" title="Friday 4 July 2025 03:41">Friday 4 July 2025</span>. Using Julia version 1.11.5.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
